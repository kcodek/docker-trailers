version: '3'
services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.2.0
    container_name: elasticsearch
    ports:
      - "9200:9200"
      - "9300:9300"
    environment:
      discovery.type: single-node
      # DISCOVERY_TYPE: single-node
    volumes:
      - esdata01:/usr/share/elasticsearch/data
    networks:
      - esnet


  kibana:
    image: docker.elastic.co/kibana/kibana:7.2.0
    container_name: kibana
    ports:
      - "5601:5601"
    depends_on:
      - elasticsearch  
    # volumes:
    #     - ./kibana.yml: /usr/share/kibana/config/kibana.yml
    environment:
      ELASTICSEARCH_HOSTS: http://elasticsearch:9200
    networks:
     - esnet


  filebeat:
    image: docker.elastic.co/beats/filebeat:7.2.0
    networks:
      - esnet
    depends_on:
      - elasticsearch
      - kibana
    environment:
      setup.kibana.host: kibana:5601
      output.elasticsearch.hosts: "elasticsearch:9200"
      # SETUP_KIBANA_HOST: kibana:5601
      # OUTPUT_ELASTICSEARCH_HOSTS: "elasticsearch:9200"
    command: filebeat -e -strict.perms=false
    # volumes:
    #   - ./filebeat.docker.yml:/usr/share/filebeat/filebeat.yml:ro
    #   - ./filebeat_sample_log:/usr/share/filebeat/logs


  # logstash:
  #   # build: logstash/
  #   image: docker.elastic.co/logstash/logstash:7.2.0
  #   command: -f /etc/logstash/conf.d/
  #   ports:
  #     - "5000:5000"
  #     - "5044:5044"
  #   networks:
  #     - esnet
  #   depends_on:
  #     - elasticsearch
  # # restart: unless-stopped
    # volumes:
    #   - ./logstash/config:/etc/logstash/conf.d
    #   - ./logs:/logs



volumes:
  esdata01:
    driver: local

networks:
  esnet:
    driver: bridge    